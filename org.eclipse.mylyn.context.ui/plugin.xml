<?xml version="1.0" encoding="UTF-8"?>
<?eclipse version="3.0"?>
<?eclipse version="3.0"?>
<plugin>
    <extension-point id="bridges" name="bridges" schema="schema/bridges.exsd"/>
    <extension-point id="startup" name="Context UI Startup" schema="schema/startup.exsd"/>

    <extension 
         point="org.eclipse.mylyn.context.core.bridges">
      <structureBridge 
      		class="org.eclipse.mylyn.internal.context.ui.TaskStructureBridge"/> 
   </extension>
   <extension 
         point="org.eclipse.mylyn.context.ui.bridges">
      <uiBridge
            class="org.eclipse.mylyn.internal.context.ui.TaskUiBridge"
            contentType="meta/task"/>
   </extension>   
 
 	<extension
         point="org.eclipse.mylyn.tasks.ui.editors">
      	<pageFactory
             id="org.eclipse.mylyn.context.ui.pageFactory.Context"
			 class="org.eclipse.mylyn.internal.context.ui.editors.ContextPageFactory"/>
   	</extension>
 
  	<extension point = "org.eclipse.ui.popupMenus">
     <objectContribution
        id="org.eclipse.mylyn.context.ui.actions.interest.contribution"
        objectClass="org.eclipse.mylyn.context.core.IInteractionElement">
        <!-- API-3.0: remove? -->
     	<action  
  		  	label="Mark Less Interesting" 
	  		tooltip="Mark selected element as uninteresting"
	  		menubarPath="additions" 
	  		id="org.eclipse.mylyn.context.ui.actions.interest.decrement" 
	  		class="org.eclipse.mylyn.internal.context.ui.actions.InterestDecrementAction"
	  		icon="icons/elcl16/interest-decrease.gif"
	  		enablesFor="*"/>
	    <action  
  		  	label="Mark as Landmark" 
	  		tooltip="Make selected element a landmark"
	  		menubarPath="additions" 
	  		id="org.eclipse.mylyn.context.ui.actions.interest.increment" 
	  		class="org.eclipse.mylyn.internal.context.ui.actions.InterestIncrementAction"
	  		icon="icons/elcl16/interest-increase.gif"
	  		enablesFor="*"/>
	 </objectContribution> 
	 
	 <objectContribution
            adaptable="false"
            id="org.eclipse.mylyn.context.ui.task.attachment.contribution"
            objectClass="org.eclipse.mylyn.internal.tasks.core.deprecated.RepositoryAttachment">
         <action
               class="org.eclipse.mylyn.internal.context.ui.actions.ContextRetrieveAction"
               enablesFor="1"
               icon="icons/etool16/context-retrieve.gif"
               id="org.eclipse.mylyn.context.ui.repository.task.retrieve"
               label="Retrieve Context"
               menubarPath="actions"/>
      </objectContribution>
	 <!--
	 <objectContribution
           adaptable="false"
           id="org.eclipse.mylyn.context.ui.tasks.contribution"
           objectClass="org.eclipse.mylyn.internal.tasks.core.AbstractTask">
		<action
              class="org.eclipse.mylyn.internal.context.ui.actions.ContextClearAction"
              enablesFor="1"
              icon="icons/elcl16/context-clear.gif"
              id="org.eclipse.mylyn.context.ui.task.clear"
              label="Clear Context"
              menubarPath="context"
              tooltip="Clear Context">
        </action>
  		<action
        	class="org.eclipse.mylyn.internal.context.ui.actions.ContextCopyAction"
        	icon="icons/elcl16/context-transfer.gif"
        	id="org.eclipse.mylyn.context.ui.task.copy.context.to"
        	label="Copy Context to..."
        	menubarPath="context"
        	tooltip="Copy Context to...">
  		</action>
	 </objectContribution>
	 -->
	 
	 <!--
     <objectContribution
           adaptable="false"
           id="org.eclipse.mylyn.ui.tasks.repository.hits..action.contribution"
           objectClass="org.eclipse.mylyn.internal.tasks.core.AbstractTask">
        <action
              class="org.eclipse.mylyn.internal.context.ui.actions.ContextRetrieveAction"
              enablesFor="1"
              icon="icons/etool16/context-retrieve.gif"
              id="org.eclipse.mylyn.context.ui.repository.task.retrieve"
              label="Retrieve Context..."
              menubarPath="context">
        </action> 
        <action
              class="org.eclipse.mylyn.internal.context.ui.actions.ContextAttachAction"
              enablesFor="1"
              icon="icons/etool16/context-attach.gif"
              id="org.eclipse.mylyn.context.ui.repository.task.attach"
              label="Attach Context..."
              menubarPath="context">
        </action>
	 </objectContribution>
	 -->
   </extension>
    
    <!-- See org.eclipse.mylyn.tasks.ui/plugin.xml -->
   	<extension
         point="org.eclipse.mylyn.context.ui.bridges">
      <preservedFilters
			viewId="org.eclipse.ui.navigator.ProjectExplorer">
			<filter
				id="org.eclipse.mylyn.tasks.ui.navigator.filters.tasks">
			</filter>
	  </preservedFilters> 
   </extension> 
    
   <extension
         point="org.eclipse.ui.preferencePages">
      <page
            name="Context"
            class="org.eclipse.mylyn.internal.context.ui.preferences.ContextUiPreferencePage"
            id="org.eclipse.mylyn.context.ui.preferences"
            category="org.eclipse.mylyn.tasks.ui.preferences">
         <keywordReference id="org.eclipse.mylyn.context.ui.keywords"/>
      </page> 
   </extension>
   
   <extension
   		point="org.eclipse.ui.keywords">
      <keyword
            label="mylyn context focus focused"
            id="org.eclipse.mylyn.context.ui.keywords"/>
   </extension>
 
	<!-- ==================== Common Navigator ==================== -->
    <extension
         point="org.eclipse.ui.navigator.viewer">
       <!--
       <viewer
             viewerId="org.eclipse.mylyn.context.ui.navigator.context">
          <popupMenu
                allowsPlatformContributions="false"
                id="org.eclipse.mylyn.context.ui.navigator.context#PopupMenu">  
             <insertionPoint name="group.new"/>
             <insertionPoint
                   	name="group.open"
                   	separator="true"/>
             <insertionPoint 
             		name="group.openWith"/>     
             <insertionPoint
                   name="additions"
                   separator="true"/>              
			 <insertionPoint
                   name="group.port"
                   separator="true"/>  
             <insertionPoint
                   name="group.properties"
                   separator="true"/>
          </popupMenu>
       </viewer>
       -->
       <viewerContentBinding 
             viewerId="org.eclipse.mylyn.context.ui.navigator.context">
          <includes>
       	      <contentExtension pattern="org.eclipse.ui.navigator.resourceContent"/>		       	      
          </includes>
       </viewerContentBinding>
       
       <viewerContentBinding 
             viewerId="org.eclipse.mylyn.context.ui.navigator.context.quick">
          <includes>
       	      <contentExtension pattern="org.eclipse.ui.navigator.resourceContent"/>		       	      
          </includes>
       </viewerContentBinding>
       
       <viewerActionBinding
            viewerId="org.eclipse.mylyn.context.ui.navigator.context">
         <includes>
             <actionExtension pattern="org.eclipse.ui.navigator.resources.*" />
         </includes>
       </viewerActionBinding>
   </extension>	
     
   <!-- ==================== Actions ==================== -->
    
   <extension
       	 point="org.eclipse.ui.actionSets">
   	  <actionSet
            label="Task Context"
            description="Task Context"
            visible="true"
            id="org.eclipse.mylyn.context.ui.actionSet">
         <!--
         <action
               class="org.eclipse.mylyn.internal.context.ui.actions.InterestDecrementAction"
               definitionId="org.eclipse.mylyn.context.ui.commands.interest.decrement"
               icon="icons/elcl16/interest-decrease.gif"
               id="org.eclipse.mylyn.context.ui.actions.interest.decrement"
               label="Mark Less Interesting"
               menubarPath="navigate/open.ext2">
         </action>
         <action
               class="org.eclipse.mylyn.internal.context.ui.actions.InterestIncrementAction"
               definitionId="org.eclipse.mylyn.context.ui.commands.interest.increment"
               icon="icons/elcl16/interest-increase.gif"
               id="org.eclipse.mylyn.context.ui.actions.interest.increment"
               label="Mark as Landmark"
               menubarPath="navigate/open.ext2">
         </action>
		 -->
	     <action
               definitionId="org.eclipse.mylyn.context.ui.commands.open.context.dialog"
               label="Quick Context View"
               class="org.eclipse.mylyn.internal.context.ui.actions.OpenQuickContextPopupDialogAction"
               menubarPath="navigate/showIn"
               id="org.eclipse.mylyn.context.ui.actions.open.context.dialog">
         </action>
      </actionSet>
   </extension>
                              
   <extension point="org.eclipse.ui.commands">
      <category
            name="Focused UI"
            description="Task-Focused Interface"
            id="org.eclipse.mylyn.context.ui.commands">
      </category>
      <command
            name="Make Landmark"
            description="Make Landmark"
            id="org.eclipse.mylyn.context.ui.commands.interest.increment"
            categoryId="org.eclipse.mylyn.context.ui.commands">
      </command>
      <command
            name="Make Less Interesting"
            description="Make Less Interesting"
            id="org.eclipse.mylyn.context.ui.commands.interest.decrement"
            categoryId="org.eclipse.mylyn.context.ui.commands">
      </command>
      <command
            name="Show Context Quick View"
            description="Show Context Quick View"
            id="org.eclipse.mylyn.context.ui.commands.open.context.dialog"
            categoryId="org.eclipse.mylyn.context.ui.commands">
      </command>
      <command
            defaultHandler="org.eclipse.mylyn.internal.context.ui.commands.FocusViewHandler"
            id="org.eclipse.mylyn.context.ui.commands.focus.view"
            name="Focus View">
         <commandParameter
               id="viewId"
               name="View ID to Focus"
               optional="false">
         </commandParameter>
      </command>
      <command
            categoryId="org.eclipse.mylyn.context.ui.commands"
            id="org.eclipse.mylyn.context.ui.commands.task.attachContext"
            name="Attach Context">
      </command>
      <command
            categoryId="org.eclipse.mylyn.context.ui.commands"
            id="org.eclipse.mylyn.context.ui.commands.task.retrieveContext"
            name="Retrieve Context">
      </command>
      <command
            categoryId="org.eclipse.mylyn.context.ui.commands"
            id="org.eclipse.mylyn.context.ui.commands.task.copyContext"
            name="Copy Context">
      </command>
      <command
            categoryId="org.eclipse.mylyn.context.ui.commands"
            id="org.eclipse.mylyn.context.ui.commands.task.clearContext"
            name="Clear Context">
      </command>
      <command
            categoryId="org.eclipse.mylyn.context.ui.commands"
            id="org.eclipse.mylyn.context.ui.commands.attachment.retrieveContext"
            name="Retrieve Context Attachment">
      </command>
   </extension>
     
   <extension point="org.eclipse.ui.bindings">     
      <key
            sequence="M1+M2+M3+ARROW_UP"
            commandId="org.eclipse.mylyn.context.ui.commands.interest.increment"
            schemeId ="org.eclipse.ui.defaultAcceleratorConfiguration">
      </key>
      <key
            sequence="M1+M2+M3+ARROW_DOWN"
            commandId="org.eclipse.mylyn.context.ui.commands.interest.decrement"
            schemeId="org.eclipse.ui.defaultAcceleratorConfiguration">
      </key>
      <key
            sequence="M1+M2+M3+ARROW_RIGHT"
            commandId="org.eclipse.mylyn.context.ui.commands.open.context.dialog"
            schemeId="org.eclipse.ui.defaultAcceleratorConfiguration">
      </key>
   </extension>     

   <extension point="org.eclipse.ui.decorators">
      <decorator
            lightweight="true"
            label="Task Context Decorator"
            class="org.eclipse.mylyn.internal.context.ui.InterestDecoratorLightweight"
            state="true"
            id="org.eclipse.mylyn.context.ui.decorator.interest">
         <description>
			Decorates the labels of elements to indicate whether they are a part of the task context.
		 </description>
         <enablement>
            <objectClass name="java.lang.Object"/>
         </enablement>
      </decorator>
   </extension>

 <extension point="org.eclipse.ui.viewActions"> 
 	<viewContribution 
		id="org.eclipse.mylyn.context.ui.taskList.contribution" 
   		targetID="org.eclipse.mylyn.tasks.ui.views.tasks">
    	<action
           class="org.eclipse.mylyn.internal.context.ui.actions.FocusTaskListAction"
           enablesFor="*"
           icon="icons/eview16/focus-tasklist.gif"
           id="org.eclipse.mylyn.context.ui.actions.tasklist.focus"
           label="Focus on Workweek"
           menubarPath="additions"
           style="toggle"
           toolbarPath="context"
           tooltip="Focus on Workweek"/> 
  	</viewContribution>
	<viewContribution 
		id="org.eclipse.mylyn.context.ui.outline.contribution" 
   		targetID="org.eclipse.ui.views.ContentOutline">
    	<action
           class="org.eclipse.mylyn.internal.context.ui.actions.FocusOutlineAction"
           disabledIcon="icons/elcl16/focus-disabled.gif"
           enablesFor="*"
           icon="icons/elcl16/focus.gif"
           id="org.eclipse.mylyn.context.ui.contentOutline.focus"
           label="Focus on Active Task"
           menubarPath="mylyn"
           style="toggle"
           toolbarPath="mylyn"
           tooltip="Focus on Active Task (Alt+click to reveal filtered elements)">
        <enablement>
           <systemProperty
                 name="org.eclipse.mylyn.context.core.context.active"
                 value="true">
           </systemProperty>
        </enablement>
  		</action> 
  	</viewContribution>
   </extension>
 <extension
       point="org.eclipse.ui.menus">
    <menuContribution
          locationURI="popup:org.eclipse.ui.popup.any?after=operations">
       <menu
             id="org.eclipse.mylyn.context.ui.menu.task.context"
             label="Context">
          <visibleWhen
                checkEnabled="false">
             <and>
                <count
                      value="1">
                </count>
                <iterate>
                   <adapt
                         type="org.eclipse.mylyn.tasks.core.ITask">
                   </adapt>
                </iterate>
             </and>
          </visibleWhen>
          <separator
                name="group.repository"
                visible="true">
          </separator>
          <command
                commandId="org.eclipse.mylyn.context.ui.commands.task.attachContext"
                icon="icons/etool16/context-attach.gif"
                label="Attach..."
                style="push">
          </command>
          <command
                commandId="org.eclipse.mylyn.context.ui.commands.task.retrieveContext"
                icon="icons/etool16/context-retrieve.gif"
                label="Retrieve..."
                style="push">
          </command>
          <separator
                name="group.local"
                visible="true">
          </separator>
          <command
                commandId="org.eclipse.mylyn.context.ui.commands.task.copyContext"
                icon="icons/elcl16/context-transfer.gif"
                label="Copy to..."
                style="push">
          </command>
          <command
                commandId="org.eclipse.mylyn.context.ui.commands.task.clearContext"
                icon="icons/elcl16/context-clear.gif"
                label="Clear"
                style="push">
          </command>
          <separator
                name="additions">
          </separator>
       </menu>
    </menuContribution>
    <menuContribution
          locationURI="popup:org.eclipse.ui.popup.any?after=additions">
       <command
             commandId="org.eclipse.mylyn.context.ui.commands.attachment.retrieveContext"
             icon="icons/etool16/context-retrieve.gif"
             label="Retrieve Context"
             style="push">
          <visibleWhen
                checkEnabled="false">
             <and>
                <count
                      value="1">
                </count>
                <iterate>
                   <adapt
                         type="org.eclipse.mylyn.tasks.core.ITaskAttachment">
                   </adapt>
                </iterate>
             </and>
          </visibleWhen>
       </command>
    </menuContribution>
 </extension>
 <extension
       point="org.eclipse.ui.handlers">
    <handler
          class="org.eclipse.mylyn.internal.context.ui.commands.AttachContextHandler"
          commandId="org.eclipse.mylyn.context.ui.commands.task.attachContext">
       <enabledWhen>
          <iterate
                ifEmpty="false"
                operator="and">
             <and>
                <instanceof
                      value="org.eclipse.mylyn.tasks.core.ITask">
                </instanceof>
                <test
                      property="org.eclipse.mylyn.task.canPostAttachment"
                      value="true">
                </test>
             </and>
          </iterate>
       </enabledWhen>
    </handler>
    <handler
          class="org.eclipse.mylyn.internal.context.ui.commands.RetrieveContextHandler"
          commandId="org.eclipse.mylyn.context.ui.commands.task.retrieveContext">
       <enabledWhen>
          <iterate
                ifEmpty="false"
                operator="and">
             <and>
                <instanceof
                      value="org.eclipse.mylyn.tasks.core.ITask">
                </instanceof>
                <test
                      property="org.eclipse.mylyn.task.canGetAttachment"
                      value="true">
                </test>
                <test
                      property="org.eclipse.mylyn.task.hasRepositoryContext"
                      value="true">
                </test>
             </and>
          </iterate>
       </enabledWhen>
    </handler>
    <handler
          class="org.eclipse.mylyn.internal.context.ui.commands.CopyContextHandler"
          commandId="org.eclipse.mylyn.context.ui.commands.task.copyContext">
       <enabledWhen>
          <iterate
                ifEmpty="false"
                operator="and">
             <and>
                <instanceof
                      value="org.eclipse.mylyn.tasks.core.ITask">
                </instanceof>
                <test
                      property="org.eclipse.mylyn.task.hasLocalContext"
                      value="true">
                </test>
             </and>
          </iterate>
       </enabledWhen>
    </handler>
    <handler
          class="org.eclipse.mylyn.internal.context.ui.commands.ClearContextHandler"
          commandId="org.eclipse.mylyn.context.ui.commands.task.clearContext">
       <enabledWhen>
          <iterate
                ifEmpty="false"
                operator="and">
             <and>
                <instanceof
                      value="org.eclipse.mylyn.tasks.core.ITask">
                </instanceof>
                <test
                      property="org.eclipse.mylyn.task.hasLocalContext"
                      value="true">
                </test>
             </and>
          </iterate>
       </enabledWhen>
    </handler>
    <handler
          class="org.eclipse.mylyn.internal.context.ui.commands.RetrieveContextAttachmentHandler"
          commandId="org.eclipse.mylyn.context.ui.commands.attachment.retrieveContext">
       <enabledWhen>
          <iterate
                ifEmpty="false"
                operator="and">
             <and>
                <instanceof
                      value="org.eclipse.mylyn.tasks.core.ITaskAttachment">
                </instanceof>
                <test
                      property="org.eclipse.mylyn.task.attachment.isContext"
                      value="true">
                </test>
             </and>
          </iterate>
       </enabledWhen>
    </handler>
 </extension>
   
</plugin>
